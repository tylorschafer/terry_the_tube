<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terry the Tube - AI Beer Dispenser</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Include styles from separate CSS file */
        {STYLES_PLACEHOLDER}
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    {RECORDING_INDICATOR_HTML}
    
    <!-- Connection Status Indicator -->
    <div class="connection-indicator disconnected" id="connectionIndicator">
        <div class="recording-dot" id="connectionDot"></div>
        <span id="connectionText">Disconnected</span>
    </div>
    
    <!-- Personality Selection Overlay -->
    <div class="personality-overlay" id="personalityOverlay">
        <div class="personality-modal">
            <h2>Select Terry's Personality</h2>
            <p>Choose how Terry will interact with you today. Each personality offers a unique beer-dispensing experience!</p>
            
            <select class="personality-dropdown" id="personalityDropdown" onchange="handlePersonalityChange()">
                <option value="">Choose a personality...</option>
                <option value="sarcastic_comedian">Obnoxious Sarcastic Comedian</option>
<!--                <option value="passive_aggressive_librarian">Passive Aggressive Librarian</option>-->
                <option value="condescending_childrens_host">Children's Show Host</option>
                <option value="dungeon_master">Dungeon Master</option>
                <option value="glitching_ai">Glitching AI</option>
                <option value="disappointed_dad">Disappointed Dad</option>
<!--                <option value="corporate_hr_drone">Corporate HR Drone</option>-->
<!--                <option value="hot_mess_aunt">Hot Mess Aunt</option>-->
            </select>
            
            <button class="confirm-btn" id="confirmPersonalityBtn" disabled>
                Start Your Beer Journey
            </button>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">TERRY THE TUBE</h1>
            <p class="subtitle">Your AI Beer Dispenser</p>
        </div>
        
        <div class="status-card">
            <div class="status" id="status">
                <i class="fas fa-beer"></i>
                <span>Ready to serve beer!</span>
            </div>
        </div>
        
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-avatar">T</div>
                <div class="chat-info">
                    <h3>Terry</h3>
                    <p id="personalityDisplay">Your AI Bartender</p>
                </div>
            </div>
            <div class="messages" id="messages">
                <!-- Messages will be added dynamically -->
            </div>
            <div class="response-loading" id="responseLoading">
                <div class="response-loading-text">
                    <div class="spinner"></div>
                    <span>Generating response...</span>
                </div>
            </div>
            <div class="tts-loading" id="ttsLoading">
                <div class="tts-loading-text">
                    <div class="spinner"></div>
                    <span>Generating voice...</span>
                </div>
            </div>
        </div>
        
        <div class="controls">
            {TALK_BUTTON_HTML}
            
            <!-- Text Chat Interface -->
            <div class="text-chat-container" id="textChatContainer" style="display: none;">
                <div class="text-chat-input-group">
                    <input type="text" 
                           class="text-chat-input" 
                           id="textChatInput" 
                           placeholder="Type your message here..."
                           maxlength="500">
                    <button class="text-chat-send-btn" id="textChatSendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript modules -->
    <script>
        {STATE_MANAGER_JS}
    </script>
    
    <script>
        {UI_CONTROLLER_JS}
    </script>
    
    <script>
        {WEBSOCKET_MANAGER_JS}
    </script>
    
    <script>
        {APP_CONTROLLER_JS}
    </script>
    
    <script>
        // Initialize global instances (compiled from TypeScript)
        const appState = new AppState();
        const uiController = new UIController();
        const appController = new AppController();
        
        // Make instances available globally
        window.appState = appState;
        window.uiController = uiController;
        window.appController = appController;
        
        // Make functions available globally for HTML onclick handlers
        window.startRecording = () => appController.startRecording();
        window.stopRecording = () => appController.stopRecording();
        window.populatePersonalityDropdown = () => appController.populatePersonalityDropdown();
        window.handlePersonalityChange = () => {
            console.log('Personality change handler called');
            const dropdown = document.getElementById('personalityDropdown');
            const confirmBtn = document.getElementById('confirmPersonalityBtn');
            console.log('Dropdown value:', dropdown.value);
            console.log('Button element:', confirmBtn);
            if (dropdown && dropdown.value) {
                if (confirmBtn) {
                    confirmBtn.disabled = false;
                    console.log('Button enabled');
                }
                window.appState.set('data.selectedPersonality', dropdown.value);
            } else {
                if (confirmBtn) {
                    confirmBtn.disabled = true;
                    console.log('Button disabled');
                }
                window.appState.set('data.selectedPersonality', null);
            }
        };
        
        // Initialize application when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => appController.init());
        } else {
            appController.init();
        }
    </script>
</body>
</html>
